---
import { SvgLoader } from "@/components/parts/svg/SvgLoader"
import { CommentList } from "@/components/templates/CommentList"
import { CommentPostButton } from "@/components/templates/CommentPostButton"
import styles from "@/components/views/CommentView.module.css"
import { getComments } from "@/services/api"
import { isDefined } from "@/utils"
import { transformDataToCommentInfo } from "@/utils/transformer"

const { articleUrlId } = Astro.params

if (!isDefined(articleUrlId)) {
  throw new Error("記事URL IDが存在しません")
}

const comments = await getComments(articleUrlId)
const commentInfoList = transformDataToCommentInfo(comments)
---

<div class={styles.commentView}>
  <div class={styles.header}>
    <div class={styles.left}>
      <SvgLoader height={20} name="commentWithPen" width={20} />
      <span class={styles.text}>この記事に寄せられたコメント (10)</span>
    </div>
    <CommentPostButton client:load />
  </div>

  <CommentList client:load commentList={commentInfoList} />
</div>
